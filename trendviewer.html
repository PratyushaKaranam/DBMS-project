<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
  <link href="style.css" rel="stylesheet" type="text/css">
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/1.3.8/FileSaver.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/javascript-canvas-to-blob/3.19.0/js/canvas-to-blob.js"></script>
  <script src="https://cdn.anychart.com/releases/v8/js/anychart-base.min.js?hcode=c11e6e3cfefb406e8ce8d99fa8368d33"></script>
  <script src="https://cdn.anychart.com/releases/v8/js/anychart-ui.min.js?hcode=c11e6e3cfefb406e8ce8d99fa8368d33"></script>
  <script src="https://cdn.anychart.com/releases/v8/js/anychart-exports.min.js?hcode=c11e6e3cfefb406e8ce8d99fa8368d33"></script>
  <link href="https://cdn.anychart.com/releases/v8/css/anychart-ui.min.css?hcode=c11e6e3cfefb406e8ce8d99fa8368d33" type="text/css" rel="stylesheet">
  <link href="https://cdn.anychart.com/releases/v8/fonts/css/anychart-font.min.css?hcode=c11e6e3cfefb406e8ce8d99fa8368d33" type="text/css" rel="stylesheet">

</head>

<script>
  $(document).ready(function () {
    $.ajax(
      {
        url: "/api/test/query",
        type: "GET",
        success: function (result) {
          console.log(result);
        },
        error: function (error) {
          console.log(error);
        }
      }
    )
  })


</script>


<body>
  <div class="container mt-3" id="pat">
    <ul class="nav nav-tabs">
      <li class="nav-item" id="excp">
        <a class="nav-link active" href="#">Trends Viewer</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="index.html">Home</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="ct.html">Custom Trends</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="tlt.html">Trips and Location Trends</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="ft.html">Financial Trends</a>
      </li>
    </ul>
    <!-- <div id="result">Data: </div>
            <div id="result1">Dates: </div> -->
    <table id="charts" style="width:100%">
      <tr>
        <td>Summary Statistics</td>
        <td>
          <table style="width:100%">
            <tr>
              <td>Start Date:</td>
              <td id="startdate"></td>
            </tr>
            <tr>
              <td>End Date:</td>
              <td id="enddate"></td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td><div id="myChart1"></div></td>
        <td><div id="myChart2"></div></td>
      </tr>
      <tr>
        <!-- <td><button onclick="downloadPDF1()">DOWNLOAD</button></td> -->
        <!-- <td><button onclick="toPDF()">DOWNLOAD</button></td> -->
        <!-- <td><button id="downloadPdf">DOWNLOAD</button></td> -->
        <td><button onclick="savePDF1()">DOWNLOAD</button></td>
        <td><button onclick="savePDF2()">DOWNLOAD</button></td>
      </tr>
    </table>
    <script>
      
      // Extracting dates/months from the URL

      var URLparameters = location.search.substring(1).split('&');
      var parameterKeyValue;
      //var text = "";
      var label = new Array();
      var parametervalues = new Array();
      var day;
      var month;
      var year;
      for (var i = 0; i < URLparameters.length; i++) {
        parameterKeyValue = URLparameters[i].split("=");
        label.push(unescape(parameterKeyValue[1]));                             // label stores the months or dates to be used in the graph
        parametervalues.push(unescape(parameterKeyValue[1]));
        //text += "<br>" + unescape(parameterKeyValue[1]);
      }
      //document.getElementById("result").innerHTML += text;
      if (parameterKeyValue[0] == 'enddate') {                                  // Checking if dates were selected
        var sdate = new Date(parametervalues[0]);
        var edate = new Date(parametervalues[1]);

        Date.prototype.addDay = function (days) {                 // This function generates the date after n days
          var date = new Date(this.valueOf());
          date.setDate(date.getDate() + days);
          return date;
        }
        
        function getDateArray(start, end) {                       // The function generates dates between Start and End date in MM-DD-YYYY format
          var arr = new Array();
          var dt = start;
          while (dt <= end) {
            date = new Date(dt);
            //alert(date);
            day = date.getDate();
            //alert(day);
            month = date.getMonth() + 1;
            //alert(month);
            year = date.getFullYear();
            //alert(year);
            if (day < 10) {
              //alert(day);
              day = '0' + day;
              //alert(day);
            }
            if (month < 10) {
              //alert(month)
              month = '0' + month;
              //alert(month);
            }
            var date1 = month + '-' + day + '-' + year;
            //alert(date1);
            arr.push(date1);
            dt = dt.addDay(1);                                     // call to the function addDay to generate the date for the next day
          }                                                        // this is done till all dates between the start and the end date are generated
          //alert(arr);
          return arr;
        }

        document.getElementById("startdate").innerHTML = parametervalues[0]; // This displays the start and end date on the page
        document.getElementById("enddate").innerHTML = parametervalues[1];

        label = getDateArray(sdate.addDay(1), edate.addDay(1));     // label stores the generated dates
        //alert(label);

        //alert(label);
        //document.getElementById("result1").innerHTML = label;
      }

      var dataset1 = new Array();                                   // generates random data for the graph --->NOT IMPORTANT (will be removed later)
      var dataset2 = new Array();
      for (var i = 0; i < label.length; i++) {
        dataset1.push(Math.floor(Math.random() * label.length));
        dataset2.push(Math.floor(Math.random() * label.length));
      }
      //alert(dataset);
      // creating dataset
      // var dataset = new Array(label.length);
      // for(i=0;i<dataset.length;i++){
      //   dataset[i] = new Array(2);
      // }
      // for(i=0;i<dataset.length;i++){
      //   dataset[i][0] = label[i];
      //   dataset[i][1] = dataset1[i];
      // }
      //window.alert(dataset);
    </script>

    <!-- GRAPH 1-->

    <script>
      //anychart.onDocumentReady(function (label,dataset1) {
        // create data set on our data
        var dataSet = anychart.data.set(getData(label,dataset1));
        // map data for the first series, take x from the zero column and value from the first column of data set
        var seriesData_1 = dataSet.mapAs({'x':0, 'value':1});
        // create line chart
        var chart1 = anychart.line();
        // turn on chart animation
        chart1.animation(true);
        // turn on the crosshair
        chart1.crosshair()
                .enabled(true)
                .yLabel(false)
                .yStroke(null);

        // set tooltip mode to point
        chart1.tooltip().positionMode('point');
        // set chart title text settings
        chart1.title('selected months/dates');
        // set yAxis title
        chart1.yAxis().title('Data from Database');
        chart1.xAxis().labels().padding(5);

        // create first series with mapped data
        var series_1 = chart1.line(seriesData_1);
        series_1.name('random');
        series_1.markers()
                .enabled(true)
                .type('circle')
                .size(4);
        series_1.tooltip()
                .position('right')
                .anchor('left-center')
                .offsetX(5)
                .offsetY(5);

        chart1.legend()
                .enabled(true)
                .fontSize(13)
                .padding([0, 0, 10, 0]);
        // set container id for the chart
        chart1.container('myChart1');
        // initiate chart drawing
        chart1.draw();
      function getData(label,dataset1) {
        var dataset = new Array(label.length);
        for(i=0;i<dataset.length;i++){
          dataset[i] = new Array(2);
        }
        for(i=0;i<dataset.length;i++){
          dataset[i][0] = label[i];
          dataset[i][1] = dataset1[i];
        }

        return dataset;
      }
    </script>

    <!-- GRAPH 2-->

    <script>
      //anychart.onDocumentReady(function (label,dataset1) {
        // create data set on our data
        var dataSet = anychart.data.set(getData(label,dataset2));
        // map data for the first series, take x from the zero column and value from the first column of data set
        var seriesData_1 = dataSet.mapAs({'x':0, 'value':1});
        // create line chart
        var chart2 = anychart.line();
        // turn on chart animation
        chart2.animation(true);
        // turn on the crosshair
        chart2.crosshair()
                .enabled(true)
                .yLabel(false)
                .yStroke(null);

        // set tooltip mode to point
        chart2.tooltip().positionMode('point');
        // set chart title text settings
        chart2.title('selected months/dates');
        // set yAxis title
        chart2.yAxis().title('Data from Database');
        chart2.xAxis().labels().padding(5);

        // create first series with mapped data
        var series_1 = chart2.line(seriesData_1);
        series_1.name('random');
        series_1.markers()
                .enabled(true)
                .type('circle')
                .size(4);
        series_1.tooltip()
                .position('right')
                .anchor('left-center')
                .offsetX(5)
                .offsetY(5);

        chart2.legend()
                .enabled(true)
                .fontSize(13)
                .padding([0, 0, 10, 0]);
        // set container id for the chart
        chart2.container('myChart2');
        // initiate chart drawing
        chart2.draw();
      function getData(label,dataset2) {
        var dataset = new Array(label.length);
        for(i=0;i<dataset.length;i++){
          dataset[i] = new Array(2);
        }
        for(i=0;i<dataset.length;i++){
          dataset[i][0] = label[i];
          dataset[i][1] = dataset2[i];
        }

        return dataset;
      }


      // var chart2 = document.getElementById('myChart2').getContext('2d');
      // var myChart = new Chart(chart2, {
      //   type: 'line',
      //   data: {
      //     //labels: ['Red', 'Blue', 'Yellow', 'Green', 'Purple', 'Orange'],
      //     labels: label,
      //     datasets: [{
      //       label: '# random',
      //       data: dataset2,
      //       // backgroundColor: [
      //       //   'rgba(255, 99, 132, 0.2)',
      //       //   'rgba(54, 162, 235, 0.2)',
      //       //   'rgba(255, 206, 86, 0.2)',
      //       //   'rgba(75, 192, 192, 0.2)',
      //       //   'rgba(153, 102, 255, 0.2)',
      //       //   'rgba(255, 159, 64, 0.2)'
      //       // ],
      //       borderColor: [
      //         'rgba(255, 99, 132, 1)',
      //         //   'rgba(54, 162, 235, 1)',
      //         //   'rgba(255, 206, 86, 1)',
      //         //   'rgba(75, 192, 192, 1)',
      //         //   'rgba(153, 102, 255, 1)',
      //         //   'rgba(255, 159, 64, 1)'
      //       ],
      //       borderWidth: 3
      //     }]
      //   },
      //   options: {
      //     scales: {
      //       yAxes: [{
      //         ticks: {
      //           beginAtZero: true
      //         }
      //       }]
      //     }
      //   }
      // });


    </script>
  </div>

  <script>
    function savePDF1(){
      chart1.saveAsPdf('a2',true,5,5,'PdfChart1');
    }
    function savePDF2(){
      chart2.saveAsPdf('a2',true,5,5,'PdfChart2');
    }
  </script>
</body>

</html>