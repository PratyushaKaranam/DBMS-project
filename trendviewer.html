<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
  <link href="style.css" rel="stylesheet" type="text/css">
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/1.3.8/FileSaver.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/javascript-canvas-to-blob/3.19.0/js/canvas-to-blob.js"></script>
  <script src="https://cdn.anychart.com/releases/v8/js/anychart-base.min.js?hcode=c11e6e3cfefb406e8ce8d99fa8368d33"></script>
  <script src="https://cdn.anychart.com/releases/v8/js/anychart-ui.min.js?hcode=c11e6e3cfefb406e8ce8d99fa8368d33"></script>
  <script src="https://cdn.anychart.com/releases/v8/js/anychart-exports.min.js?hcode=c11e6e3cfefb406e8ce8d99fa8368d33"></script>
  <link href="https://cdn.anychart.com/releases/v8/css/anychart-ui.min.css?hcode=c11e6e3cfefb406e8ce8d99fa8368d33" type="text/css" rel="stylesheet">
  <link href="https://cdn.anychart.com/releases/v8/fonts/css/anychart-font.min.css?hcode=c11e6e3cfefb406e8ce8d99fa8368d33" type="text/css" rel="stylesheet">

</head>

<script>
  $(document).ready(function () {
    $.ajax(
      {
        url: "/api/test/query",
        type: "GET",
        success: function (result) {
          console.log(result);
        },
        error: function (error) {
          console.log(error);
        }
      }
    )
  })


</script>


<body>
  <div class="container mt-3" id="pat">
    <ul class="nav nav-tabs">
      <li class="nav-item" id="excp">
        <a class="nav-link active" href="#">Trends Viewer</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="index.html">Home</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="ct.html">Custom Trends</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="tlt.html">Trips and Location Trends</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="ft.html">Financial Trends</a>
      </li>
    </ul>
    <!-- <div id="result">Data: </div>
            <div id="result1">Dates: </div> -->
    <table id="charts" style="width:100%">
      <tr>
        <td>Summary Statistics</td>
        <td>
          <table style="width:100%">
            <tr>
              <td id="startdatename"></td>
              <td id="startdate"></td>
            </tr>
            <tr>
              <td id="enddatename"></td>
              <td id="enddate"></td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td><div id="myChart1"></div></td>
        <td><div id="myChart2"></div></td>
      </tr>
      <tr>
        <!-- <td><button onclick="downloadPDF1()">DOWNLOAD</button></td> -->
        <!-- <td><button onclick="toPDF()">DOWNLOAD</button></td> -->
        <!-- <td><button id="downloadPdf">DOWNLOAD</button></td> -->
        <td><button onclick="savePDF1()">DOWNLOAD</button></td>
        <td><button onclick="savePDF2()">DOWNLOAD</button></td>
      </tr>
    </table>
    <script>
      
      // Extracting dates/months from the URL

      var URLparameters = location.search.substring(1).split('&');
      var parameterKeyValue;
      //var text = "";
      var label = new Array();
      var parametervalues = new Array();
      var day;
      var month;
      var year;
      var type = URLparameters[0].split("=");
      var builder = unescape(type[1]);                                        // builder stores whether tripAndLocation or Financial
      //alert(builder);                                               
      for (var i = 1; i < URLparameters.length; i++) {
        parameterKeyValue = URLparameters[i].split("=");
        label.push(unescape(parameterKeyValue[1]));                             // label stores the months or dates to be used in the graph
        parametervalues.push(unescape(parameterKeyValue[1]));
        //text += "<br>" + unescape(parameterKeyValue[1]);
      }
      //document.getElementById("result").innerHTML += text;
      if (parameterKeyValue[0] == 'enddate') {                                  // Checking if dates were selected
        var sdate = new Date(parametervalues[0]);
        var edate = new Date(parametervalues[1]);

        Date.prototype.addDay = function (days) {                 // This function generates the date after n days
          var date = new Date(this.valueOf());
          date.setDate(date.getDate() + days);
          return date;
        }
        
        function getDateArray(start, end) {                       // The function generates dates between Start and End date in MM-DD-YYYY format
          var arr = new Array();
          var dt = start;
          while (dt <= end) {
            date = new Date(dt);
            //alert(date);
            day = date.getDate();
            //alert(day);
            month = date.getMonth() + 1;
            //alert(month);
            year = date.getFullYear();
            //alert(year);
            if (day < 10) {
              //alert(day);
              day = '0' + day;
              //alert(day);
            }
            if (month < 10) {
              //alert(month)
              month = '0' + month;
              //alert(month);
            }
            var date1 = month + '-' + day + '-' + year;
            //alert(date1);
            arr.push(date1);
            dt = dt.addDay(1);                                     // call to the function addDay to generate the date for the next day
          }                                                        // this is done till all dates between the start and the end date are generated
          //alert(arr);
          return arr;
        }
        document.getElementById("startdatename").innerHTML = 'START DATE:'; 
        document.getElementById("enddatename").innerHTML = 'END DATE:';
        document.getElementById("startdate").innerHTML = parametervalues[0]; // This displays the start and end date on the page
        document.getElementById("enddate").innerHTML = parametervalues[1];

        label = getDateArray(sdate.addDay(1), edate.addDay(1));     // label stores the generated dates
        //alert(label);

        //alert(label);
        //document.getElementById("result1").innerHTML = label;
      }
      else{
        var text ="";
        for(var i=0;i<label.length;i++){
          text += label[i] + ", ";
        }
        document.getElementById("startdatename").innerHTML = 'SELECTED MONTHS:';
        document.getElementById("startdate").innerHTML = text;
        document.getElementById("enddatename").style.border= '0px black solid';
        document.getElementById("enddate").style.border= '0px black solid';
      }
      var dataset1 = new Array();                                   // generates random data for the graph --->NOT IMPORTANT (will be removed later)
      var dataset2 = new Array();
      for (var i = 0; i < label.length; i++) {
        dataset1.push(Math.floor(Math.random() * label.length));
        dataset2.push(Math.floor(Math.random() * label.length));
      }

    </script>

    <script>
      // converting json to chart readable data

      var testjson = {"GrossRevPerDay":["17.76285106382978723404255319148936170213","16.85053892215568862275449101796407185629","17.10154786150712830957230142566191446029","17.26588582677165354330708661417322834646","17.73985257985257985257985257985257985258","18.79582159624413145539906103286384976526","17.3054466230936819172113289760348583878","18.24198347107438016528925619834710743802","18.35986166007905138339920948616600790514","18.1577534791252485089463220675944333996","17.4034375","16.02373271889400921658986175115207373272","16.52412037037037037037037037037037037037","18.26788259958071278825995807127882599581","17.94441558441558441558441558441558441558","19.34770325203252032520325203252032520325","18.94293859649122807017543859649122807018","16.71494929006085192697768762677484787018","17.93562060889929742388758782201405152225","17.44793269230769230769230769230769230769","18.92088036117381489841986455981941309255","18.72017543859649122807017543859649122807","17.89818181818181818181818181818181818182","16.41572383073496659242761692650334075724","16.41255874673629242819843342036553524804","16.04610315186246418338108882521489971347","16.84916149068322981366459627329192546584","18.83056555269922879177377892030848329049","18.84801801801801801801801801801801801802","19.3747136563876651982378854625550660793","18.56686746987951807228915662650602409639","16.60296523517382413087934560327198364008","17.67883826879271070615034168564920273349","18.48513574660633484162895927601809954751","17.66359801488833746898263027295285359801","17.93087794432548179871520342612419700214","19.42072380952380952380952380952380952381","17.79822709163346613545816733067729083665","17.30539449541284403669724770642201834862","16.80073604060913705583756345177664974619","17.22744034707158351409978308026030368764","19.075","18.39381156316916488222698072805139186296","17.58953586497890295358649789029535864979","18.71948076923076923076923076923076923077","16.25723320158102766798418972332015810277","17.05675355450236966824644549763033175355","18.53205314009661835748792270531400966184","18.44326","17.55081896551724137931034482758620689655","18.03316504854368932038834951456310679612","18.34512241054613935969868173258003766478","17.19597189695550351288056206088992974239","17.27767441860465116279069767441860465116","17.35791284403669724770642201834862385321","17.08903587443946188340807174887892376682","18.858","18.75196998123827392120075046904315196998","17.10340551181102362204724409448818897638","15.95420581655480984340044742729306487696","19.16466666666666666666666666666666666667","18.65235154394299287410926365795724465558","18.73219753086419753086419753086419753086","18.44797826086956521739130434782608695652","18.66652830188679245283018867924528301887","17.73533854166666666666666666666666666667","16.36069518716577540106951871657754010695","17.90617886178861788617886178861788617886","17.52705445544554455445544554455445544554","18.21983014861995753715498938428874734607","18.30813819577735124760076775431861804223","17.27938856015779092702169625246548323471","19.30751037344398340248962655601659751037","17.04224948875255623721881390593047034765","18.96248081841432225063938618925831202046","19.59058004640371229698375870069605568445","18.37619450317124735729386892177589852008","18.05241035856573705179282868525896414343","19.72534246575342465753424657534246575342","18.72783365570599613152804642166344294004","16.66106217616580310880829015544041450777","18.31364130434782608695652173913043478261","19.37309633027522935779816513761467889908","20.05163855421686746987951807228915662651","19.37004065040650406504065040650406504065","17.67005747126436781609195402298850574713","18.82659877800407331975560081466395112016","16.98504524886877828054298642533936651584","17.49388451443569553805774278215223097113","19.31128878281622911694510739856801909308","16.92659142212189616252821670428893905192","18.26830508474576271186440677966101694915","18.85639622641509433962264150943396226415","18.40161478599221789883268482490272373541","16.72927855711422845691382765531062124248","17.20823383084577114427860696517412935323","19.85313465783664459161147902869757174393","18.03798687089715536105032822757111597374","17.80982646420824295010845986984815618221","18.02259398496240601503759398496240601504","17.39785425101214574898785425101214574899","16.30832271762208067940552016985138004246","17.55519287833827893175074183976261127596","18.18960297766749379652605459057071960298","17.26358862144420131291028446389496717724","17.09384773662551440329218106995884773663","17.96430861723446893787575150300601202405","17.21634249471458773784355179704016913319","17.17178644763860369609856262833675564682","16.83223650385604113110539845758354755784","18.31553658536585365853658536585365853659","18.21772009029345372460496613995485327314","17.84359201773835920177383592017738359202","17.55775681341719077568134171907756813417","17.45645879732739420935412026726057906459","17.63097447795823665893271461716937354988","17.47467866323907455012853470437017994859","17.41904076738609112709832134292565947242","19.17902612826603325415676959619952494062","18.12274944567627494456762749445676274945","18.18175213675213675213675213675213675214","16.05151709401709401709401709401709401709","17.0013101604278074866310160427807486631"],"Days":["01-MAY-19","02-MAY-19","03-MAY-19","04-MAY-19","05-MAY-19","06-MAY-19","07-MAY-19","08-MAY-19","09-MAY-19","10-MAY-19","11-MAY-19","12-MAY-19","13-MAY-19","14-MAY-19","15-MAY-19","16-MAY-19","17-MAY-19","18-MAY-19","19-MAY-19","20-MAY-19","21-MAY-19","22-MAY-19","23-MAY-19","24-MAY-19","25-MAY-19","26-MAY-19","27-MAY-19","28-MAY-19","29-MAY-19","30-MAY-19","31-MAY-19","01-JUN-19","02-JUN-19","03-JUN-19","04-JUN-19","05-JUN-19","06-JUN-19","07-JUN-19","08-JUN-19","09-JUN-19","10-JUN-19","11-JUN-19","12-JUN-19","13-JUN-19","14-JUN-19","15-JUN-19","16-JUN-19","17-JUN-19","18-JUN-19","19-JUN-19","20-JUN-19","21-JUN-19","22-JUN-19","23-JUN-19","24-JUN-19","25-JUN-19","26-JUN-19","27-JUN-19","28-JUN-19","29-JUN-19","30-JUN-19","01-JUL-19","02-JUL-19","03-JUL-19","04-JUL-19","05-JUL-19","06-JUL-19","07-JUL-19","08-JUL-19","09-JUL-19","10-JUL-19","11-JUL-19","12-JUL-19","13-JUL-19","14-JUL-19","15-JUL-19","16-JUL-19","17-JUL-19","18-JUL-19","19-JUL-19","20-JUL-19","21-JUL-19","22-JUL-19","23-JUL-19","24-JUL-19","25-JUL-19","26-JUL-19","27-JUL-19","28-JUL-19","29-JUL-19","30-JUL-19","31-JUL-19","01-AUG-19","02-AUG-19","03-AUG-19","04-AUG-19","05-AUG-19","06-AUG-19","07-AUG-19","08-AUG-19","09-AUG-19","10-AUG-19","11-AUG-19","12-AUG-19","13-AUG-19","14-AUG-19","15-AUG-19","16-AUG-19","17-AUG-19","18-AUG-19","19-AUG-19","20-AUG-19","21-AUG-19","22-AUG-19","23-AUG-19","24-AUG-19","25-AUG-19","26-AUG-19","27-AUG-19","28-AUG-19","29-AUG-19","30-AUG-19","31-AUG-19"]}
      var keys = Object.keys(testjson);
      //alert(keys[0]);
      var arrt1 = Object.values(testjson)[0];
      var arr1 = new Array();
      arr1=arrt1;
      //alert(arrt1[0]);
      var arrt2 = Object.values(testjson)[1];
      var arr2 = new Array();
      arr2 = arrt2;
      //for(i=0;i<arr1.length;i++){
      //  console.log(arr1[i]);
      //}
      //console.log(arr2.type);
    </script>

    <!-- GRAPH 1-->

    <script>
      //anychart.onDocumentReady(function (label,dataset1) {
        // create data set on our data
        var dataSet = anychart.data.set(getData(label,dataset1));
        // map data for the first series, take x from the zero column and value from the first column of data set
        var seriesData_1 = dataSet.mapAs({'x':0, 'value':1});
        // create line chart
        var chart1 = anychart.line();
        // turn on chart animation
        chart1.animation(true);
        // turn on the crosshair
        chart1.crosshair()
                .enabled(true)
                .yLabel(false)
                .yStroke(null);

        // set tooltip mode to point
        chart1.tooltip().positionMode('point');
        // set chart title text settings
        chart1.title('selected months/dates');
        // set yAxis title
        chart1.yAxis().title('Data from Database');
        chart1.xAxis().labels().padding(5);

        // create first series with mapped data
        var series_1 = chart1.line(seriesData_1);
        series_1.name('random');
        series_1.markers()
                .enabled(true)
                .type('circle')
                .size(4);
        series_1.tooltip()
                .position('right')
                .anchor('left-center')
                .offsetX(5)
                .offsetY(5);

        chart1.legend()
                .enabled(true)
                .fontSize(13)
                .padding([0, 0, 10, 0]);
        // set container id for the chart
        chart1.container('myChart1');
        // initiate chart drawing
        chart1.draw();
        // creating chart dataset from data
      function getData(label,dataset1) {
        var dataset = new Array(label.length);
        for(i=0;i<dataset.length;i++){
          dataset[i] = new Array(2);
        }
        for(i=0;i<dataset.length;i++){
          dataset[i][0] = label[i];
          dataset[i][1] = dataset1[i];
        }

        return dataset;
      }
    </script>

    <!-- GRAPH 2-->

    <script>
      //anychart.onDocumentReady(function (label,dataset1) {
        // create data set on our data
        var dataSet = anychart.data.set(getData(arr1,arr2));
        // map data for the first series, take x from the zero column and value from the first column of data set
        var seriesData_1 = dataSet.mapAs({'x':0, 'value':1});
        // create line chart
        var chart2 = anychart.line();
        // turn on chart animation
        chart2.animation(true);
        // turn on the crosshair
        chart2.crosshair()
                .enabled(true)
                .yLabel(false)
                .yStroke(null);

        // set tooltip mode to point
        chart2.tooltip().positionMode('point');
        // set chart title text settings
        chart2.title('selected months/dates');
        // set yAxis title
        chart2.yAxis().title(keys[0]);
        chart2.xAxis().labels().padding(5);

        // create first series with mapped data
        var series_1 = chart2.line(seriesData_1);
        series_1.name(keys[0]);
        series_1.markers()
                .enabled(true)
                .type('circle')
                .size(4);
        series_1.tooltip()
                .position('right')
                .anchor('left-center')
                .offsetX(5)
                .offsetY(5);

        chart2.legend()
                .enabled(true)
                .fontSize(13)
                .padding([0, 0, 10, 0]);
        // set container id for the chart
        chart2.container('myChart2');
        // initiate chart drawing
        chart2.draw();
        // creating chart dataset from data
        function getData(arr1,arr2){
          var dataset = new Array(arr1.length);
          for(i=0;i<dataset.length;i++){
            dataset[i] = new Array(2);
          }
          for(i=0;i<dataset.length;i++){
            dataset[i][0] = arr2[i];
            dataset[i][1] = arr1[i];
          }
      // function getData(label,dataset2) {
      //   var dataset = new Array(label.length);
      //   for(i=0;i<dataset.length;i++){
      //     dataset[i] = new Array(2);
      //   }
      //   for(i=0;i<dataset.length;i++){
      //     dataset[i][0] = label[i];
      //     dataset[i][1] = dataset2[i];
      //   }
          //console.log(dataset);
          return dataset;
        }


      // var chart2 = document.getElementById('myChart2').getContext('2d');
      // var myChart = new Chart(chart2, {
      //   type: 'line',
      //   data: {
      //     //labels: ['Red', 'Blue', 'Yellow', 'Green', 'Purple', 'Orange'],
      //     labels: label,
      //     datasets: [{
      //       label: '# random',
      //       data: dataset2,
      //       // backgroundColor: [
      //       //   'rgba(255, 99, 132, 0.2)',
      //       //   'rgba(54, 162, 235, 0.2)',
      //       //   'rgba(255, 206, 86, 0.2)',
      //       //   'rgba(75, 192, 192, 0.2)',
      //       //   'rgba(153, 102, 255, 0.2)',
      //       //   'rgba(255, 159, 64, 0.2)'
      //       // ],
      //       borderColor: [
      //         'rgba(255, 99, 132, 1)',
      //         //   'rgba(54, 162, 235, 1)',
      //         //   'rgba(255, 206, 86, 1)',
      //         //   'rgba(75, 192, 192, 1)',
      //         //   'rgba(153, 102, 255, 1)',
      //         //   'rgba(255, 159, 64, 1)'
      //       ],
      //       borderWidth: 3
      //     }]
      //   },
      //   options: {
      //     scales: {
      //       yAxes: [{
      //         ticks: {
      //           beginAtZero: true
      //         }
      //       }]
      //     }
      //   }
      // });


    </script>
  </div>

  <script>
    function savePDF1(){
      chart1.saveAsPdf('a2',true,5,5,'PdfChart1');
    }
    function savePDF2(){
      chart2.saveAsPdf('a2',true,5,5,'PdfChart2');
    }
  </script>
</body>

</html>