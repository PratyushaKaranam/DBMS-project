<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
  <link href="style.css" rel="stylesheet" type="text/css">
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.min.js"></script>
</head>

<script>
  $(document).ready(function () {
    $.ajax(
      {
        url: "/api/test/query",
        type: "GET",
        success: function (result) {
          console.log(result);
        },
        error: function (error) {
          console.log(error);
        }
      }
    )
  })


</script>


<body>
  <div class="container mt-3" id="pat">
    <ul class="nav nav-tabs">
      <li class="nav-item" id="excp">
        <a class="nav-link active" href="#">Trends Viewer</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="index.html">Home</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="ct.html">Custom Trends</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="tlt.html">Trips and Location Trends</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="ft.html">Financial Trends</a>
      </li>
    </ul>
    <!-- <div id="result">Data: </div>
            <div id="result1">Dates: </div> -->
    <table id="charts" style="width:100%">
      <tr>
        <td>Summary Statistics</td>
        <td>
          <table style="width:100%">
            <tr>
              <td>Start Date:</td>
              <td id="startdate"></td>
            </tr>
            <tr>
              <td>End Date:</td>
              <td id="enddate"></td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td><canvas id="myChart1"></canvas></td>
        <td><canvas id="myChart2"></canvas></td>
      </tr>
      <tr>
        <td><button onclick="downloadPDF1()">DOWNLOAD</button></td>
        <td><button onclick="downloadPDF2()">DOWNLOAD</button></td>
      </tr>
    </table>
    <script>
      
      // Extracting dates/months from the URL

      var URLparameters = location.search.substring(1).split('&');
      var parameterKeyValue;
      //var text = "";
      var label = new Array();
      var parametervalues = new Array();
      var day;
      var month;
      var year;
      for (var i = 0; i < URLparameters.length; i++) {
        parameterKeyValue = URLparameters[i].split("=");
        label.push(unescape(parameterKeyValue[1]));                             // label stores the months or dates to be used in the graph
        parametervalues.push(unescape(parameterKeyValue[1]));
        //text += "<br>" + unescape(parameterKeyValue[1]);
      }
      //document.getElementById("result").innerHTML += text;
      if (parameterKeyValue[0] == 'enddate') {                                  // Checking if dates were selected
        var sdate = new Date(parametervalues[0]);
        var edate = new Date(parametervalues[1]);

        Date.prototype.addDay = function (days) {                 // This function generates the date after n days
          var date = new Date(this.valueOf());
          date.setDate(date.getDate() + days);
          return date;
        }
        
        function getDateArray(start, end) {                       // The function generates dates between Start and End date in MM-DD-YYYY format
          var arr = new Array();
          var dt = start;
          while (dt <= end) {
            date = new Date(dt);
            //alert(date);
            day = date.getDate();
            //alert(day);
            month = date.getMonth() + 1;
            //alert(month);
            year = date.getFullYear();
            //alert(year);
            if (day < 10) {
              //alert(day);
              day = '0' + day;
              //alert(day);
            }
            if (month < 10) {
              //alert(month)
              month = '0' + month;
              //alert(month);
            }
            var date1 = month + '-' + day + '-' + year;
            //alert(date1);
            arr.push(date1);
            dt = dt.addDay(1);                                     // call to the function addDay to generate the date for the next day
          }                                                        // this is done till all dates between the start and the end date are generated
          //alert(arr);
          return arr;
        }

        document.getElementById("startdate").innerHTML = parametervalues[0]; // This displays the start and end date on the page
        document.getElementById("enddate").innerHTML = parametervalues[1];

        label = getDateArray(sdate.addDay(1), edate.addDay(1));     // label stores the generated dates
        //alert(label);

        //alert(label);
        //document.getElementById("result1").innerHTML = label;
      }

      var dataset1 = new Array();                                   // generates random data for the graph --->NOT IMPORTANT (will be removed later)
      var dataset2 = new Array();
      for (var i = 0; i < label.length; i++) {
        dataset1.push(Math.floor(Math.random() * label.length));
        dataset2.push(Math.floor(Math.random() * label.length));
      }
                //alert(dataset);
    </script>

    <!-- GRAPH 1-->

    <script>
      var chart1 = document.getElementById('myChart1').getContext('2d');
      var myChart = new Chart(chart1, {
        type: 'line',
        data: {
          //labels: ['Red', 'Blue', 'Yellow', 'Green', 'Purple', 'Orange'],
          labels: label,                                                    
          datasets: [{
            label: '# random',
            data: dataset1,                                                 
            // backgroundColor: [
            //   'rgba(255, 99, 132, 0.2)',
            //   'rgba(54, 162, 235, 0.2)',
            //   'rgba(255, 206, 86, 0.2)',
            //   'rgba(75, 192, 192, 0.2)',
            //   'rgba(153, 102, 255, 0.2)',
            //   'rgba(255, 159, 64, 0.2)'
            // ],
            borderColor: [
              'rgba(255, 99, 132, 1)',
              //   'rgba(54, 162, 235, 1)',
              //   'rgba(255, 206, 86, 1)',
              //   'rgba(75, 192, 192, 1)',
              //   'rgba(153, 102, 255, 1)',
              //   'rgba(255, 159, 64, 1)'
            ],
            borderWidth: 3
          }]
        },
        options: {
          scales: {
            yAxes: [{
              ticks: {
                beginAtZero: true
              }
            }]
          }
        }
      });
    </script>

    <!-- GRAPH 2-->

    <script>
      var chart2 = document.getElementById('myChart2').getContext('2d');
      var myChart = new Chart(chart2, {
        type: 'line',
        data: {
          //labels: ['Red', 'Blue', 'Yellow', 'Green', 'Purple', 'Orange'],
          labels: label,
          datasets: [{
            label: '# random',
            data: dataset2,
            // backgroundColor: [
            //   'rgba(255, 99, 132, 0.2)',
            //   'rgba(54, 162, 235, 0.2)',
            //   'rgba(255, 206, 86, 0.2)',
            //   'rgba(75, 192, 192, 0.2)',
            //   'rgba(153, 102, 255, 0.2)',
            //   'rgba(255, 159, 64, 0.2)'
            // ],
            borderColor: [
              'rgba(255, 99, 132, 1)',
              //   'rgba(54, 162, 235, 1)',
              //   'rgba(255, 206, 86, 1)',
              //   'rgba(75, 192, 192, 1)',
              //   'rgba(153, 102, 255, 1)',
              //   'rgba(255, 159, 64, 1)'
            ],
            borderWidth: 3
          }]
        },
        options: {
          scales: {
            yAxes: [{
              ticks: {
                beginAtZero: true
              }
            }]
          }
        }
      });
    </script>
  </div>

  <script>
    //document.getElementById('cmd').addEventListener("click", downloadPDF);
    function downloadPDF1() {
	    var Canvas = document.querySelector('#myChart1');

      //create image from dummy canvas
	    var CanvasImg = Canvas.toDataURL("image/jpeg", 1.0);
  
  	  //creates PDF from img
	    var doc = new jsPDF('landscape');
	    //doc.setFontSize(20);
	    //doc.text(15, 15);
	    doc.addImage(CanvasImg, 'JPEG', 20, 20, 250, 100);
	    doc.save('canvas1.pdf');
    }
    //document.getElementById('cmd').addEventListener("click", downloadPDF);
    function downloadPDF2() {
	    var Canvas = document.querySelector('#myChart2');

      //create image from dummy canvas
	    var CanvasImg = Canvas.toDataURL("image/jpeg", 1.0);
  
  	  //creates PDF from img
	    var doc = new jsPDF('landscape');
	    //doc.setFontSize(20);
	    //doc.text(15, 15);
	    doc.addImage(CanvasImg, 'JPEG', 20, 20, 250, 100);
	    doc.save('canvas2.pdf');
    }
  </script>
</body>

</html>